{{/* USAGE: {{ partial "libsass" (dict "src" "styles/main.scss" "targetPath" "main.css") }} */}}

{{ $src := .src -}}
{{ $targetPath := .targetPath | default (replace $src "scss" "css") -}}

{{ $options := (dict "targetPath" $targetPath "transpiler" "libsass" "includePaths" (slice "node_modules")) -}}

{{ if eq (hugo.Environment) "development" -}}
{{ $options := merge $options (dict "enableSourceMap" "true") -}}
{{ else -}}
{{ $options := merge $options (dict "outputStyle" "compressed" ) -}}
{{ end }}

{{ $css := resources.Get $src | toCSS $options -}}

{{ if eq (hugo.Environment) "production" -}}
{{ $css = $css | postCSS (dict "config" "postcss.config.js") | fingerprint }}
{{ end }}

<link rel="stylesheet" href="{{ $css.Permalink | relURL }}" integrity="{{ $css.Data.Integrity }}" crossorigin="anonymous">
